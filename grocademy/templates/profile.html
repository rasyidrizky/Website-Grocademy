{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <h1 class="mb-4">My Profile</h1>
    <div class="card">
        <div class="card-header">
            Account Details
        </div>
        <div class="card-body">
            <ul class="list-group list-group-flush">
                <li class="list-group-item">
                    <strong>Username:</strong> <span id="profile-username">Loading...</span>
                </li>
                <li class="list-group-item">
                    <strong>Full Name:</strong> <span id="profile-fullname">Loading...</span>
                </li>
                <li class="list-group-item">
                    <strong>Email:</strong> <span id="profile-email">Loading...</span>
                </li>
                <li class="list-group-item">
                    <strong>Current Balance:</strong> <span id="profile-balance">Loading...</span>
                </li>
            </ul>
        </div>
    </div>

    <div class="mt-4">
        <a href="/history" class="btn btn-info">View Purchase History</a>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', async () => {
        const token = localStorage.getItem('accessToken');
        if (!token) return;

        try {
            const response = await fetch('/api/auth/self/', {
                headers: { 'Authorization': `Bearer ${token}` }
            });
            const user = await response.json();

            if (user) {
                document.getElementById('profile-username').textContent = user.username;
                document.getElementById('profile-fullname').textContent = `${user.first_name} ${user.last_name}`;
                document.getElementById('profile-email').textContent = user.email;
                document.getElementById('profile-balance').textContent = `$${parseFloat(user.balance).toFixed(2)}`;
            }
        } catch (error) {
            console.error('Failed to load profile data:', error);
            document.querySelector('.card-body').innerHTML = '<p class="text-danger">Could not load profile information.</p>';
        }
    });
</script>
{% endblock %}