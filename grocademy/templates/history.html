{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <h1 class="mb-4">Purchase History</h1>

    <table class="table table-striped">
        <thead>
            <tr>
                <th scope="col">Date</th>
                <th scope="col">Course Title</th>
                <th scope="col">Instructor</th>
                <th scope="col">Price</th>
            </tr>
        </thead>
        <tbody id="history-table-body">
            <tr><td colspan="4">Loading history...</td></tr>
        </tbody>
    </table>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', async () => {
        const token = localStorage.getItem('accessToken');
        if (!token) return;

        const response = await fetch('/api/history/', {
            headers: { 'Authorization': `Bearer ${token}` }
        });
        const historyData = await response.json();
        const tableBody = document.getElementById('history-table-body');

        if (historyData.results.length === 0) {
            tableBody.innerHTML = '<tr><td colspan="4">No purchase history found.</td></tr>';
            return;
        }

        let html = '';
        historyData.results.forEach(item => {
            const date = new Date(item.purchased_at).toLocaleDateString('en-GB');
            html += `
                <tr>
                    <td>${date}</td>
                    <td>${item.course.title}</td>
                    <td>${item.course.instructor}</td>
                    <td>$${parseFloat(item.course.price).toFixed(2)}</td>
                </tr>
            `;
        });
        tableBody.innerHTML = html;
    });
</script>
{% endblock %}